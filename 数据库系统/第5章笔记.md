

第五章：会画ER图，画得合理，不需要在ER图中体现扩展实体的内容。基本的就够用了。ER图向关系模式的转化要注意。物理设计的基本概念（效率） 这些概念要知道。

## 第五章 数据库设计

数据库设计有以下两种方法：面向数据（以信息需求为主）；面向过程（以处理需求为主）。由于数据相对稳定，处理则容易变动，数据库设计主要采用面向数据的设计方法。

数据库设计的六个基本阶段：需求分析（最困难、耗时的一步）；概念结构设计（关键）；逻辑结构设计（将概念结构转换为某个DBMS所支持的模型；优化）；物理结构设计（选取最适合应用环境的物理结构，存取结构和存取方法）；数据库实施；数据库运行和维护。其中 需求分析和概念结构设计 独立于DBMS；逻辑设计和物理结构设计与选用的DBMS密切相关。

![image-20240607091741572](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240607091741572.png)

ER模型同时具有客观性(反应客观世界的事物)和主观性(反应事物的哪一部分)。

**实体和属性的设计：**

基本属性和复合属性(可再分的属性)

单值属性和多值属性(对一个实体对象可以取多个值)

多值属性的处理：将原来的多值属性用几个新的单值属性来表示/用一个新的实体类型表示

导出属性：不直接存储，而是通过其他属性值计算得到的值。

空值

**联系的设计：**

![image-20240607092629886](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240607092629886.png)

基数比约束：一个联系可以存在几个(在画图时在对面那边)

参与约束(参与度)：有两个实体集E1和E2，E1中每个实体与E2有联系实体的数目的最小值min和最大值max，称为E1的(基数)参与度，用(min,max)来表示。(画图时在自己这边)

**ER模型的操作：**分裂、合并、增删。

不合法的操作：将一个三元联系分裂为一个二元联系

**扩充的ER模型**，考试不涉及

弱实体：不独立存在、必须依赖其他实体的属性。职工和职工亲属

普遍化/特殊化：ISA、是...的一种抽象。 如果概括是不相交并且是全部的，即一个高层实体最多并且只能属于一个低层实体集，则可以不为高层实体集建立关系键。

子类和超类：子类由超类继承而来，子类本身比超类包含更多的属性；子类和超类具有相同的标识符号。

聚集：两个联系直接的连接。

范畴：总结两个实体的共性形成一个新的实体

**概念设计的策略：**自顶向下、自底向上、由内向外、混合策略。

**概念设计的方法：**集中式模式设计法(适合小规模应用)、视图集成法(局部视图设计+视图集成)

视图集成法中合并ER图 需要检查并消除冲突

解决冲突：命名冲突(同名异义、同义异名)、属性冲突(属性域冲突：值、属性取值**单位**冲突)、类型冲突(实体和属性间的冲突)、约束冲突(语义约束方面的不一致)

消除冗余：数据冗余(由其他基本数据导出的数据)和联系冗余(由其他基本联系导出的联系)。容易引起数据的不一致

**ER模型向关系模型的转化**：

+ 实体转换为关系模式 键->键
+ 非原子属性：多值属性和复合属性建议都横向展开，因为纵向展开会改变键。纵向展开一般是指一行变为多行、横向展开指变成多个属性
+ 实体间的联系转换为关系模式

> 对一个通讯录关系模式，存放姓名和电话号码。
>
> 但是一个人可能有多个电话号码，这样就出现了多值属性。
>
> 横向展开就是 以拥有最多电话号码的数量为n，存放电话号码1~电话号码n。
>
> 纵向展开就是不改变属性，但是主键由姓名变为姓名+电话号码，这样一个人就能存多个电话号码了。

**举例**

![image-20240607101847544](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240607101847544.png)

联系上的属性是非必须的。由于是一对一的联系：所以CK是K1或K2都行。

![image-20240607101947348](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240607101947348.png)

![image-20240607102027926](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240607102027926.png)

![image-20240607102227033](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240607102227033.png)

![image-20240607102235895](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240607102235895.png)

下划线表示主键、下滑波浪线表示外键



确定数据库存放位置和存储结构时要综合考虑**存取时间、存储空间利用率和维护代价**三方面的因素。不能既要有要

![image-20240607103959077](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240607103959077.png)

**常用的存取方法：**

索引法：加快按某个属性进行存取的效率，建立在单个关系上。如 建立B+树

聚簇法：为提高按聚簇键进行查询的效率，将聚簇键上具有相同值的元组存放在连续物理块。一个数据库可以有多个聚簇，但一个关系只能有一个聚簇；可以建立在单表上，也可以建立在有连接操作的多个表上。SQL中与聚簇有关的操作有：ORDER BY, GROUP BY, UNION, DISTINCT等

HASH法：设计合理的HASH函数，根据关键字值计算得到存储地址

**是否采用索引**

![image-20240607104431080](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240607104431080.png)

建表以后默认在CK上建立索引聚簇（是否有取决于DBMS）

![image-20240607104706943](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240607104706943.png)

**是否采用聚簇**

![image-20240607105039881](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240607105039881.png)

## 答疑后

老师的意思是不会考无聊的概念题，比如数据库的设计有两种是 面向数据/面向过程。

出的设计ER图的题，难度>=食堂这个题

![image-20240607130427842](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240607130427842.png)

![image-20240607133427303](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240607133427303.png)

这个作答基本是对的，但是少了注册的一步

下面这个作答补充了注册这一步，但是它后面的部分没有上面的写的好

![image-20240607133449767](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240607133449767.png)

![image-20240607133636536](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240607133636536.png)

## 作业

联系和实体中出现了引用其他实体的候选键，则一定要标记外键，不管这个外键是不是你的候选键

**解决ER图中联系会产生多次的问题：**给联系加一个编号主键。

比较特殊的一个，图书馆关系模式中处理借阅图书的联系时，需要考虑还书的情况。涉及到创建一个能够追踪借阅和还书状态的借阅记录系统。

借阅记录表

1. 记录每次借阅的详细信息。
2. 有一个唯一的主键，如“借阅ID”，用于标识每次借阅。
3. 包含外键，分别指向图书（Book）和读者（Borrower）的表。
4. 包含借阅日期（Loan Date）和预定的还书日期（Due Date）。

还书记录表

1. 用于记录还书的信息。
2. 有一个唯一的主键，如“还书ID”。
3. 包含外键，指向“Loans”表，以便关联到特定的借阅记录。