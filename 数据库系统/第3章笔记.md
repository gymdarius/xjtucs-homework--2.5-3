## SQL语言

内容：数据定义语言(DDL)[create,drop,alter]、数据查询语言(DQL)[select]、数据操纵语言(DML)[insert,update,delete]、数据控制语言(DCL)[grant,revoke 管理权限]

特点：综合统一、高度非过程化、面向集合的操作方式、以同一种语法结构提供多种使用方式(独立/嵌入式)、语言简洁

### DDL

能看懂就行，一个模式有多个表，一个表属于一个模式

索引、视图、模式的概念

### DQL

![image-20240617161223323](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240617161223323.png)

![image-20240617161309232](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240617161309232.png)

查询经过计算的值

通过列别名来改变查询的结果 `Select Sname Name,2021-Sage Birthday`

去重查询结果 `DISTINCT`, 默认为 `ALL` 不去重

查询条件：比较([NOT]+各种运算符)、确定范围(BETWEEN AND/NOT BETWEEN AND)、确定集合(IN/NOT IN):IN ('IS','CS','MA')、字符匹配(LIKE/NOT LIKE)[匹配固定值，含通配符的字符串(%:匹配0个或者多个字符。_:匹配一个字符)]；【ESCAPE '＼' 表示“ ＼” 为换码字符 ，通过换码字符将通配字符转义为普通字符 _ %】、空值(IS NULL/ IS NOT NULL)[不能用`=`代替 IS]、 多重条件(逻辑运算)(AND OR NOT ) 【AND优先级高于OR，可通过括号改变优先级】

ORDER BY ASC | DESC  空值相当于最小值

#### SQL函数

**标量函数**：运算对象是一个记录行在某个属性上的具体取值

LENGTH():计算一个字符串类型数值的长度

ABS():计算一个数值类型的绝对值

**聚集函数**：具有统计性质，运算对象通常是记录的集合或一组记录在某个列上的全部取值，聚集函数的返回结果一般将会是惟一的一个确定值

+ COUNT：计数，不会记录为NULL的值
+ SUM：计算总和
+ AVG：计算平均值
+ 最值：MAX、MIN

group by子句分组：细化聚集函数的作用对象。分组后，聚集函数的作用对象由整个查询结果变为每个组。作用对象是查询的中间结果表。按指定列的值分组，值相等的为一组。

使用group by 的前提是出现了聚集函数，且聚集函数的作用对象不是整体时（可以用聚集函数前面有没有要查的别的判断/根据题意判断）

注意聚集函数不能嵌套 MAX(AVG(GRADE))是错误的用法

having 作用于组，从中选择满足条件的组。where作用于基表或视图，从中选择满足条件的元组。

#### 连接查询

等值与非等值连接查询

自连接：一个表与自己连接，需要给表取别名来区别

外连接：`FROM Student LEFT JOIN SC ON (Student.Sno=SC.Sno) `

Student表为连接主题，将主体表中不满足连接条件的元组也一并输出

复合条件连接：where子句中含有多个连接条件

嵌套查询：应该SELECT-FROM-WHERE语句称为一个查询块，将一个查询块嵌套在另一个查询块的WHERE子句或having短语的条件中的查询是嵌套查询

不相关子查询、相关子查询（外层循环的值出现在了内层循环），带有IN谓词的子查询。（IN用=代替的前提是，子查询的结果只有一个）

带有比较运算符的子查询：当能确切的知道内层查询返回单值时，可用比较运算符。与SOME、ANY、ALL等谓词配合使用。

子查询一定要跟在比较符之后，不能子查询在前，运算符和属性名在后面

SOME(ANY):任意一个值；ALL:所有值

**带有EXIST谓词的子查询**

只产生true/flase，内层查询结果为非空，外层where子句返回真值，内层查询结果为空，返回假值。NOT EXIST相反

![image-20240617173359195](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240617173359195.png)

exist语句难点

![image-20240617174401714](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240617174401714.png)

![image-20240617174413639](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240617174413639.png)

![image-20240617174422018](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240617174422018.png)

![image-20240617174440044](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240617174440044.png)

![image-20240617174448411](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240617174448411.png)

中间这层进最里面那层的是Cno，依次判断S03选择的课程

#### 集合查询

参加集合操作的各查询结果的列数必须相同；对应项的数据类型也必须相同。

UNION 并操作 ：将多个查询结果合并起来，系统自动去掉重复原则；

UNION ALL：将多个查询结果合并起来时，保留重复元组

INTERSECT 交操作

EXCEPT 差操作

### DML 

#### 数据插入

INSERT  INTO  <表名> [(列名，…列名)]    		

VALUES  (列值，…列值)

![image-20240617190445291](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240617190445291.png)

#### 数据删除

DELETE   FROM  <表名>     [WHERE 条件表达式]

#### 数据修改

UPDATE   <表名>	

SET  <列名>＝<列值表达式>[，<列名>＝<列值表达式>…]	

[WHERE 条件表达式]

### 视图

**定义**

**查询**

由于视图中并不存储数据记录，因此处理视图查询时系统会首先将视图查询语句中的WHERE条件与视图定义中的WHERE条件进行有效合并，然后再转变为对基本表的查询

**更新的限制 **

并不是所有的视图记录都能够惟一的对应到基本表中的一条记录

**应用**

1. 提供的数据的逻辑独立性
2. 简化了用户应用
3. 提供了一定的数据安全保护功能

### DCL

权限：用户级权限、表级权限。

角色

![image-20240617192254283](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240617192254283.png)

### 嵌入式SQL

可执行语句（数据定义、数据控制、数据操作）、说明性语句

![image-20240617192603243](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240617192603243.png)

![image-20240617192635974](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240617192635974.png)

宿主变量 也叫 主变量

指示变量，给主变量赋空值

游标： SQL语句向应用程序输出数据，协调SQL语言与主语言两种不同的数据处理方式。

宿主语言语句一次只能处理一条记录，而SQL是面向集合的，游标将面向集合转变为面向记录的

![image-20240617193252652](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240617193252652.png)

以下情况不需要使用游标：

1. 说明性语句
2. 数据定义语句
3. 数据控制语句
4. 查询结果为单记录的SELECT语句
5. 非CURRENT形式的UPDATE语句
6. 非CURRENT形式的DELETE语句
7. INSERT语句

### 动态SQL

嵌入式SQL是静态SQL

![image-20240617194714409](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240617194714409.png)

![image-20240620161232963](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240620161232963.png)

![image-20240620161241105](https://gitee.com/du-jianyu1012/img/raw/master/picture/image-20240620161241105.png)

## 找出至少供应代号为256的商店所供应的全部商品的商店名和所在城市。



## 没有供应代号为256的商店所供应的任何商品的商店名和所在城市